<!-- base -->
{% extends "template/base.html" %}
<!-- base -->
{% block content %}

<main class="px-2 pt-2">
  <div class="d-flex justify-content-between mt-4 mb-3">
    <div class="">
      <h3>메모장</h3>
    </div>

    <a href="/newpost">
      <button class="btn btn-success">글쓰기</button>
    </a>
  </div>

  {% for data in datas %}
  <article class="post my-2 p-2 border">
    <input type="hidden" value="{{data.id}}" class="post-id" />
    <div>제목 : {{data.title}}</div>
    <div>내용 : {{data.content}}</div>
    <div class="d-flex justify-content-end">
      <button class="post__update-btn btn btn-warning mx-2">수정</button>
      <button class="post__delete-btn btn btn-danger mx-2">삭제</button>
    </div>
  </article>
  {% endfor %} Lorem, ipsum dolor sit amet consectetur adipisicing elit. Omnis,
  veritatis. Doloremque dolore suscipit quibusdam, odit deleniti quae labore
  nulla reiciendis sint, modi tenetur amet consectetur ratione vel eos fugit
  quis! Lorem, ipsum dolor sit amet consectetur adipisicing elit. Omnis,
  veritatis. Doloremque dolore suscipit quibusdam, odit deleniti quae labore
  nulla reiciendis sint, modi tenetur amet consectetur ratione vel eos fugit
  quis! Lorem, ipsum dolor sit amet consectetur adipisicing elit. Omnis,
  veritatis. Doloremque dolore suscipit quibusdam, odit deleniti quae labore
  nulla reiciendis sint, modi tenetur amet consectetur ratione vel eos fugit
  quis! Lorem, ipsum dolor sit amet consectetur adipisicing elit. Omnis,
  veritatis. Doloremque dolore suscipit quibusdam, odit deleniti quae labore
  nulla reiciendis sint, modi tenetur amet consectetur ratione vel eos fugit
  quis! Lorem, ipsum dolor sit amet consectetur adipisicing elit. Omnis,
  veritatis. Doloremque dolore suscipit quibusdam, odit deleniti quae labore
  nulla reiciendis sint, modi tenetur amet consectetur ratione vel eos fugit
  quis! Lorem, ipsum dolor sit amet consectetur adipisicing elit. Omnis,
  veritatis. Doloremque dolore suscipit quibusdam, odit deleniti quae labore
  nulla reiciendis sint, modi tenetur amet consectetur ratione vel eos fugit
  quis! Lorem, ipsum dolor sit amet consectetur adipisicing elit. Omnis,
  veritatis. Doloremque dolore suscipit quibusdam, odit deleniti quae labore
  nulla reiciendis sint, modi tenetur amet consectetur ratione vel eos fugit
  quis! Lorem, ipsum dolor sit amet consectetur adipisicing elit. Omnis,
  veritatis. Doloremque dolore suscipit quibusdam, odit deleniti quae labore
  nulla reiciendis sint, modi tenetur amet consectetur ratione vel eos fugit
  quis!
</main>

<script>
  const $posts = document.querySelectorAll(".post");
  const $updateBtns = document.querySelectorAll(".post__update-btn");
  const $deleteBtns = document.querySelectorAll(".post__delete-btn");

  $posts.forEach(($post) => {
    $post.addEventListener("click", (e) => {
      e.stopPropagation();
      const postId = $post.querySelector(".post-id").value;
      return (location.href = `/post/${postId}`);
    });
  });

  $updateBtns.forEach(($btn, _) => {
    $btn.addEventListener("click", (e) => {
      e.stopPropagation();

      const postId =
        $btn.parentElement.parentElement.querySelector(".post-id").value;

      return (location.href = `/newpost/${postId}`);
    });
  });

  $deleteBtns.forEach(function ($btn, _) {
    $btn.addEventListener("click", async function (e) {
      e.stopPropagation();
      if (!window.confirm("정말 삭제하시겠습니까?")) return null;

      const postId =
        $btn.parentElement.parentElement.querySelector(".post-id").value;
      console.log(postId);

      try {
        const response = await fetch(`/post/${postId}`, {
          method: "DELETE",
        });
        if (response.status === 403) {
          return alert("잠시후 다시 시도해주세요.");
        }
      } catch (e) {
        console.log(e, "asd");
      }
      alert("제거 되었습니다.");
      return location.reload();
    });
  });
</script>

{% endblock %}
