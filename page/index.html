<!-- base -->
{% extends "template/base.html" %}
<!-- base -->
{% block content %}
<!-- header -->
{% include "template/header.html" %}
<!-- header -->
<!-- content -->
<main class="">
  <div>main 화면</div>

  <a href="/newpost">
    <button class="btn btn-success">글쓰기</button>
  </a>

  {% for data in datas %}

  <article class="post m-2 p-2 border">
    <div>제목 : {{data.title}}</div>
    <div>내용 : {{data.content}}</div>
    <div class="d-flex justify-content-end">
      <button class="btn btn-warning mx-2">수정</button>
      <button class="post__delete-btn btn btn-danger mx-2">
        <input type="hidden" value="{{data.id}}" class="post-id" />
        삭제
      </button>
    </div>
  </article>
  {% endfor %}
</main>
<!-- content -->
<script>
  const $deleteBtns = document.querySelectorAll(".post__delete-btn");

  $deleteBtns.forEach(function ($btn, _) {
    $btn.addEventListener("click", async function (e) {
      e.stopPropagation();
      if (!window.confirm("정말 삭제하시겠습니까?")) return null;

      const postId = $btn.querySelector(".post-id").value;
      console.log(postId);

      try {
        const response = await fetch(`/post/${postId}`, {
          method: "DELETE",
        });
        if (response.status === 403) {
          return alert("잠시후 다시 시도해주세요.");
        }
      } catch (e) {
        console.log(e, "asd");
      }
      alert("제거 되었습니다.");
      return location.reload();
    });
  });
</script>

<!-- footer -->
{% include "template/footer.html" %}
<!-- footer -->
{% endblock %}
